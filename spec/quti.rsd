enum DayOfWeek = 
    MONDAY
    | TUESDAY
    | WEDNESDAY
    | THURSDAY
    | FRIDAY
    | SATURDAY
    | SUNDAY
;

enum Month =
    JANUARY
    | FEBRUARY
    | MARCH
    | APRIL
    | MAY
    | JUNE
    | JULY
    | AUGUST
    | SEPTEMBER
    | OCTOBER
    | DECEMBER
;

scalar ZoneId;

mixin CalendarData {
    name: string  -- Name of the calendar
    owner: string -- Owner of the calendar
}

record Calendar {
    @id key: string     -- Unique identifier of the calendar
    include CalendarData
}

record CalendarNew {
    include CalendarData
}

mixin EventRepeatData {
    interval: short -- Repeat interval
    endDate: local-date -- End date of the repeat
    timeZone: ZoneId -- Timezone in which the event repeats
}

record EventRepeatDaily {
    include EventRepeatData
}

record EventRepeatWeekly {
    include EventRepeatData
    daysOfWeek: DayOfWeek[7] -- the days in a week the event repeats
}

record EventRepeatAbsoluteMonthly {
    include EventRepeatData
    dayOfMonth: short -- the day of the month the event repeats
}

record EventRepeatAbsoluteYearly {
    include EventRepeatData
    month: Month  -- the month of the year the event repeats
}

record EventRepeatRelativeMonthly {
    include EventRepeatData
    daysOfWeek: DayOfWeek[7] -- selects the first day in a month
}

record EventRepeatRelativeYearly {
    include EventRepeatData
    daysOfWeek: DayOfWeek[7] -- selects the first day in a month
    month: Month -- the month in a year
}

union EventRepeat = 
    EventRepeatDaily('daily')
    | EventRepeatWeekly('weekly')
    | EventRepeatAbsoluteMonthly('absolute-monthly')
    | EventRepeatAbsoluteYearly('absolute-yearly')
    | EventRepeatRelativeMonthly('relative-monthly')
    | EventRepeatRelativeYearly('relative-yearly');

mixin EventData {
    title: string -- basic description
    description: string -- a more detailed description
    start: zoned-date-time -- start time
    end: zoned-date-time -- end time
    fullday: boolean -- mark it as a fullday event
    repeat?: EventRepeat -- the repeat pattern
    tags: string[] -- a list of custom tags
    referencedCalendars: string[] -- other calendars this event is referenced in
}

record EventNew {
    include EventData
}

record Event {
    @id key: string     -- Unique identifier of the event
    include EventData
}

mixin EventViewData {
    @id key: string -- unique identifier of the event
    calendarKey: string -- the calendar the event is located in
    title: string  -- basic description
    description: string -- a more detailed description
    owner: string -- owner of the event
    status: enum ACCEPTED | CANCELED -- event status
    start: zoned-date-time -- start time
    end: zoned-date-time -- end time
    tags: string[] -- a list of custom tags
    referencedCalendars: string[] -- other calendars this event is referenced in
}

record SingleEventView {
    include EventViewData
}

record SeriesMovedEventView {
    include EventViewData
    masterEventKey: string -- key of the original event
    originalStart: zoned-date-time -- the original start
    originalEnd: zoned-date-time -- the original end
}

record SeriesEventView {
    include EventViewData
    masterEventKey: string -- key of the original event
}

union EventView = 
    SingleEventView 
    | SeriesMovedEventView 
    | SeriesEventView
;

service Calendar {
    operation create(calendar: CalendarNew): string;
    
    operation eventView(key: string, start: local-date, end: local-date, timezone: ZoneId): EventView[];
    operation get(key: string): Calendar;
//    operation update(key: string, @patch changes: Calendar);    
}

service Event {
    operation create(calendar: string, event: EventNew): string;
    
//    operation get(calendar: string, key: string, timezone: ZoneId): Event;
//    operation update(calendar: string, key: string, @patch changes: Event);
    operation delete(calendar: string, key: string);

    operation cancel(calendar: string, key: string);
    operation move(calendar: string, key: string, start: zoned-date-time, end: zoned-date-time);
}